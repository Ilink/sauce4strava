<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
        <title>Safari Database Size Hack</title>
        <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&display=swap" rel="stylesheet"/>
        <link rel="stylesheet" href="/css/ext/options.css"/>
        <script defer src="/src/ext/webext.js"></script>
        <script defer src="/src/common/base.js"></script>
        <script defer src="/src/common/base_init.js"></script>
        <script defer src="/src/common/ga.js"></script>
        <script defer src="/src/common/storage.js"></script>
        <script defer src="/src/ext/safari_db_size_hack.js"></script>
        <style>
            footer .links {
                margin-top: 1em;
                display: flex;
                justify-content: center;
            }

            footer .links > a {
                padding: 0 0.5em;
            }

            section {
                max-width: 30rem;
            }

            section p {
            }

            section ol {
                margin: 0;
                padding: 0.4em 0.4em 0.4em 2em;
            }

            section ol li::marker {
                font-weight: bold;
            }

            section ol li {
                padding: 0.2em;
            }

            form.alloc-settings {
                display: flex;
                flex-direction: column;
                align-items: flex-start;
                padding: 1em;
            }

            form.alloc-settings > * {
                margin: 0.2em 0;
            }

            form.alloc-settings label > * {
                margin-left: 0.4em;
            }

            form.alloc-settings input[type="button"] {
                align-self: center;
                margin-top: 1em;
                padding: 0.4em 2em;
            }

            html:not(.active) .active-only {
                display: none;
            }
        </style>
    </head>

    <body>
        <header>
            <img src="/images/logo_vert_120x320.png"/>
            <h2 class="title">Sauce for Strava<sup>TM</sup></h2>
            <h3 class="sub-title">Safari Database Size Hack</h3>
            <a class="dismiss popup-only"></a>
        </header>

        <main>
            <section>
                <p>
                    <b>NOTE:</b> This tool is <b>ONLY</b> needed for Safari users that intend to use the
                    <a href="https://www.strava.com/sauce/performance" target="_blank" class="saucey">Sauce Performance</a>
                    feature set.</p>
                <p>
                    <b>Why does this exist?</b><br/><br/>
                    Safari defaults to a very small site storage quota that is usually insufficient for Sauce Performance users.  Unfortunatly, the only way to increase this storage quota is to actually use up more space!  Furthermore, because Sauce runs as an extension in the background it doesn't work with this design choice.  Hence the reason of this hack!
                </p>
                <p>
                    <b>How does it work?</b>
                </p>
                <ol>
                    <li>A temporary storage database (IndexedDB) is created.</li>
                    <li>We start filling up the database with dummy data.</li>
                    <li>Eventually Safari will interrupt the process with a dialog asking you for permission to use more space.  This process may repeat several times until you reach the storage goals.</li>
                    <li>After the desired size is reached the temporary database is deleted.</li>
                    <li>Your disk space is restored but the storage quota remains increased so that Sauce may run happily in the future.</li>
                </ol>
                <p>
                    <i>Remember, this tool will only <b>temporarily</b> use disk space and Sauce will only be using the storage it needs.</i>
                </p>
            </section>
            <section>
                <p>
                    <b>Enough jibber-jabber - Let's do this...</b>
                </p>
                <form class="alloc-settings">
                    <label>
                        Number of synchronized athletes:
                        <input name="athlete-count" type="number" min="1" max="100" value="1"/>
                    </label>
                    <label class="est-space">Estimated usage: <span class="usage"></span>MB</label>
                    <label class="active-only">Progress: <progress></progress></label>
                    <div class="active-only"><b><i>Remember to click "Allow" each time you're prompted.</i></b></div>
                    <input type="button" name="start" value="Start allocating space"/>
                </form>
            </section>
        </main>
    </body>
</html>
